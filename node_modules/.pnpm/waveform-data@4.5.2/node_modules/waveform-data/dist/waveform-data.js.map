{"version":3,"file":"waveform-data.js","sources":["../src/waveform-data-channel.js","../src/waveform-generator.js","../src/waveform-utils.js","../src/utils.js","../src/waveform-data.js"],"sourcesContent":["/**\n * Provides access to the waveform data for a single audio channel.\n */\n\nfunction WaveformDataChannel(waveformData, channelIndex) {\n  this._waveformData = waveformData;\n  this._channelIndex = channelIndex;\n}\n\n/**\n * Returns the waveform minimum at the given index position.\n */\n\nWaveformDataChannel.prototype.min_sample = function(index) {\n  const offset = (index * this._waveformData.channels + this._channelIndex) * 2;\n\n  return this._waveformData._at(offset);\n};\n\n/**\n * Returns the waveform maximum at the given index position.\n */\n\nWaveformDataChannel.prototype.max_sample = function(index) {\n  const offset = (index * this._waveformData.channels + this._channelIndex) * 2 + 1;\n\n  return this._waveformData._at(offset);\n};\n\n/**\n * Sets the waveform minimum at the given index position.\n */\n\nWaveformDataChannel.prototype.set_min_sample = function(index, sample) {\n  const offset = (index * this._waveformData.channels + this._channelIndex) * 2;\n\n  return this._waveformData._set_at(offset, sample);\n};\n\n/**\n * Sets the waveform maximum at the given index position.\n */\n\nWaveformDataChannel.prototype.set_max_sample = function(index, sample) {\n  const offset = (index * this._waveformData.channels + this._channelIndex) * 2 + 1;\n\n  return this._waveformData._set_at(offset, sample);\n};\n\n/**\n * Returns all the waveform minimum values as an array.\n */\n\nWaveformDataChannel.prototype.min_array = function() {\n  const length = this._waveformData.length;\n  const values = [];\n\n  for (let i = 0; i < length; i++) {\n    values.push(this.min_sample(i));\n  }\n\n  return values;\n};\n\n/**\n * Returns all the waveform maximum values as an array.\n */\n\nWaveformDataChannel.prototype.max_array = function() {\n  const length = this._waveformData.length;\n  const values = [];\n\n  for (let i = 0; i < length; i++) {\n    values.push(this.max_sample(i));\n  }\n\n  return values;\n};\n\nexport default WaveformDataChannel;\n","/**\n * AudioBuffer-based WaveformData generator\n *\n * Adapted from BlockFile::CalcSummary in Audacity, with permission.\n * See https://github.com/audacity/audacity/blob/\n *   1108c1376c09166162335fab4743008cba57c4ee/src/BlockFile.cpp#L198\n */\n\nconst INT8_MAX = 127;\nconst INT8_MIN = -128;\n\nconst INT16_MAX = 32767;\nconst INT16_MIN = -32768;\n\nfunction calculateWaveformDataLength(audio_sample_count, scale) {\n  let data_length = Math.floor(audio_sample_count / scale);\n\n  const samples_remaining = audio_sample_count - (data_length * scale);\n\n  if (samples_remaining > 0) {\n    data_length++;\n  }\n\n  return data_length;\n}\n\nfunction generateWaveformData(options) {\n  const scale = options.scale;\n  const amplitude_scale = options.amplitude_scale;\n  const split_channels = options.split_channels;\n  const length = options.length;\n  const sample_rate = options.sample_rate;\n  const channels = options.channels.map(function(channel) {\n    return new Float32Array(channel);\n  });\n  const output_channels = split_channels ? channels.length : 1;\n  const header_size = 24;\n  const data_length = calculateWaveformDataLength(length, scale);\n  const bytes_per_sample = options.bits === 8 ? 1 : 2;\n  const total_size = header_size + data_length * 2 * bytes_per_sample * output_channels;\n  const buffer = new ArrayBuffer(total_size);\n  const data_view = new DataView(buffer);\n\n  let scale_counter = 0;\n  let offset = header_size;\n\n  const min_value = new Array(output_channels);\n  const max_value = new Array(output_channels);\n\n  for (let channel = 0; channel < output_channels; channel++) {\n    min_value[channel] = Infinity;\n    max_value[channel] = -Infinity;\n  }\n\n  const range_min = options.bits === 8 ? INT8_MIN : INT16_MIN;\n  const range_max = options.bits === 8 ? INT8_MAX : INT16_MAX;\n\n  data_view.setInt32(0, 2, true); // Version\n  data_view.setUint32(4, options.bits === 8, true); // Is 8 bit?\n  data_view.setInt32(8, sample_rate, true); // Sample rate\n  data_view.setInt32(12, scale, true); // Scale\n  data_view.setInt32(16, data_length, true); // Length\n  data_view.setInt32(20, output_channels, true);\n\n  for (let i = 0; i < length; i++) {\n    let sample = 0;\n\n    if (output_channels === 1) {\n      for (let channel = 0; channel < channels.length; ++channel) {\n        sample += channels[channel][i];\n      }\n\n      sample = Math.floor(range_max * sample * amplitude_scale / channels.length);\n\n      if (sample < min_value[0]) {\n        min_value[0] = sample;\n\n        if (min_value[0] < range_min) {\n          min_value[0] = range_min;\n        }\n      }\n\n      if (sample > max_value[0]) {\n        max_value[0] = sample;\n\n        if (max_value[0] > range_max) {\n          max_value[0] = range_max;\n        }\n      }\n    }\n    else {\n      for (let channel = 0; channel < output_channels; ++channel) {\n        sample = Math.floor(range_max * channels[channel][i] * amplitude_scale);\n\n        if (sample < min_value[channel]) {\n          min_value[channel] = sample;\n\n          if (min_value[channel] < range_min) {\n            min_value[channel] = range_min;\n          }\n        }\n\n        if (sample > max_value[channel]) {\n          max_value[channel] = sample;\n\n          if (max_value[channel] > range_max) {\n            max_value[channel] = range_max;\n          }\n        }\n      }\n    }\n\n    if (++scale_counter === scale) {\n      for (let channel = 0; channel < output_channels; channel++) {\n        if (options.bits === 8) {\n          data_view.setInt8(offset++, min_value[channel]);\n          data_view.setInt8(offset++, max_value[channel]);\n        }\n        else {\n          data_view.setInt16(offset, min_value[channel], true);\n          data_view.setInt16(offset + 2, max_value[channel], true);\n          offset += 4;\n        }\n\n        min_value[channel] = Infinity;\n        max_value[channel] = -Infinity;\n      }\n\n      scale_counter = 0;\n    }\n  }\n\n  if (scale_counter > 0) {\n    for (let channel = 0; channel < output_channels; channel++) {\n      if (options.bits === 8) {\n        data_view.setInt8(offset++, min_value[channel]);\n        data_view.setInt8(offset++, max_value[channel]);\n      }\n      else {\n        data_view.setInt16(offset, min_value[channel], true);\n        data_view.setInt16(offset + 2, max_value[channel], true);\n      }\n    }\n  }\n\n  return buffer;\n}\n\nexport { generateWaveformData };\n","export function isJsonWaveformData(data) {\n  return data &&\n    typeof data === 'object' &&\n    'sample_rate' in data &&\n    'samples_per_pixel' in data &&\n    'bits' in data &&\n    'length' in data &&\n    'data' in data;\n}\n\nexport function isBinaryWaveformData(data) {\n  const isCompatible = data && typeof data === 'object' && 'byteLength' in data;\n\n  if (isCompatible) {\n    const view = new DataView(data);\n    const version = view.getInt32(0, true);\n\n    if (version !== 1 && version !== 2) {\n      throw new TypeError('WaveformData.create(): This waveform data version not supported');\n    }\n  }\n\n  return isCompatible;\n}\n\nexport function convertJsonToBinary(data) {\n  const waveformData = data.data;\n  const channels = data.channels || 1;\n  const header_size = 24; // version 2\n  const bytes_per_sample = data.bits === 8 ? 1 : 2;\n  const expected_length = data.length * 2 * channels;\n\n  if (waveformData.length !== expected_length) {\n    throw new Error('WaveformData.create(): Length mismatch in JSON waveform data');\n  }\n\n  const total_size = header_size + waveformData.length * bytes_per_sample;\n\n  const array_buffer = new ArrayBuffer(total_size);\n  const data_object = new DataView(array_buffer);\n\n  data_object.setInt32(0, 2, true); // Version\n  data_object.setUint32(4, data.bits === 8, true);\n  data_object.setInt32(8, data.sample_rate, true);\n  data_object.setInt32(12, data.samples_per_pixel, true);\n  data_object.setInt32(16, data.length, true);\n  data_object.setInt32(20, channels, true);\n\n  let index = header_size;\n\n  if (data.bits === 8) {\n    for (let i = 0; i < waveformData.length; i++) {\n      data_object.setInt8(index++, waveformData[i], true);\n    }\n  }\n  else {\n    for (let i = 0; i < waveformData.length; i++) {\n      data_object.setInt16(index, waveformData[i], true);\n\n      index += 2;\n    }\n  }\n\n  return array_buffer;\n}\n","export function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n","import WaveformDataChannel from './waveform-data-channel';\nimport { generateWaveformData } from './waveform-generator';\nimport { isJsonWaveformData, isBinaryWaveformData, convertJsonToBinary } from './waveform-utils';\nimport { isNullOrUndefined } from './utils';\nimport WaveformDataWorker from 'web-worker:./waveform-data-worker';\n\n/**\n * Provides access to waveform data.\n */\n\nfunction WaveformData(data) {\n  if (isJsonWaveformData(data)) {\n    data = convertJsonToBinary(data);\n  }\n\n  if (isBinaryWaveformData(data)) {\n    this._data = new DataView(data);\n    this._offset = this._version() === 2 ? 24 : 20;\n\n    this._channels = [];\n\n    for (let channel = 0; channel < this.channels; channel++) {\n      this._channels[channel] = new WaveformDataChannel(this, channel);\n    }\n  }\n  else {\n    throw new TypeError(\n      'WaveformData.create(): Unknown data format'\n    );\n  }\n}\n\nconst defaultOptions = {\n  scale: 512,\n  bits: 8,\n  amplitude_scale: 1.0,\n  split_channels: false,\n  disable_worker: false\n};\n\nfunction getOptions(options) {\n  const opts = {\n    scale: options.scale || defaultOptions.scale,\n    bits: options.bits || defaultOptions.bits,\n    amplitude_scale: options.amplitude_scale || defaultOptions.amplitude_scale,\n    split_channels: options.split_channels || defaultOptions.split_channels,\n    disable_worker: options.disable_worker || defaultOptions.disable_worker\n  };\n\n  return opts;\n}\n\nfunction getChannelData(audio_buffer) {\n  const channels = [];\n\n  for (let i = 0; i < audio_buffer.numberOfChannels; ++i) {\n    channels.push(audio_buffer.getChannelData(i).buffer);\n  }\n\n  return channels;\n}\n\nfunction createFromAudioBuffer(audio_buffer, options, callback) {\n  const channels = getChannelData(audio_buffer);\n\n  if (options.disable_worker) {\n    const buffer = generateWaveformData({\n      scale: options.scale,\n      bits: options.bits,\n      amplitude_scale: options.amplitude_scale,\n      split_channels: options.split_channels,\n      length: audio_buffer.length,\n      sample_rate: audio_buffer.sampleRate,\n      channels: channels\n    });\n\n    callback(undefined, new WaveformData(buffer), audio_buffer);\n  }\n  else {\n    const worker = new WaveformDataWorker();\n\n    worker.onmessage = function(evt) {\n      callback(undefined, new WaveformData(evt.data), audio_buffer);\n    };\n\n    worker.postMessage({\n      scale: options.scale,\n      bits: options.bits,\n      amplitude_scale: options.amplitude_scale,\n      split_channels: options.split_channels,\n      length: audio_buffer.length,\n      sample_rate: audio_buffer.sampleRate,\n      channels: channels\n    }, channels);\n  }\n}\n\nfunction createFromArrayBuffer(audioContext, audioData, options, callback) {\n  // The following function is a workaround for a Webkit bug where decodeAudioData\n  // invokes the errorCallback with null instead of a DOMException.\n  // See https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-decodeaudiodata\n  // and http://stackoverflow.com/q/10365335/103396\n\n  function errorCallback(error) {\n    if (!error) {\n      error = new DOMException('EncodingError');\n    }\n\n    callback(error);\n    // prevent double-calling the callback on errors:\n    callback = function() { };\n  }\n\n  const promise = audioContext.decodeAudioData(\n    audioData,\n    function(audio_buffer) {\n      createFromAudioBuffer(audio_buffer, options, callback);\n    },\n    errorCallback\n  );\n\n  if (promise) {\n    promise.catch(errorCallback);\n  }\n}\n\n/**\n * Creates and returns a WaveformData instance from the given waveform data.\n */\n\nWaveformData.create = function create(data) {\n  return new WaveformData(data);\n};\n\n/**\n * Creates a WaveformData instance from audio.\n */\n\nWaveformData.createFromAudio = function(options, callback) {\n  const opts = getOptions(options);\n\n  if (options.audio_context && options.array_buffer) {\n    return createFromArrayBuffer(options.audio_context, options.array_buffer, opts, callback);\n  }\n  else if (options.audio_buffer) {\n    return createFromAudioBuffer(options.audio_buffer, opts, callback);\n  }\n  else {\n    throw new TypeError(\n      // eslint-disable-next-line\n      'WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object'\n    );\n  }\n};\n\nfunction WaveformResampler(options) {\n  this._inputData = options.waveformData;\n\n  // Scale we want to reach\n  this._output_samples_per_pixel = options.scale;\n\n  this._scale = this._inputData.scale; // scale we are coming from\n\n  // The amount of data we want to resample i.e. final zoom want to resample\n  // all data but for intermediate zoom we want to resample subset\n  this._input_buffer_size = this._inputData.length;\n\n  const input_buffer_length_samples = this._input_buffer_size * this._inputData.scale;\n  const output_buffer_length_samples =\n    Math.ceil(input_buffer_length_samples / this._output_samples_per_pixel);\n\n  const output_header_size = 24; // version 2\n  const bytes_per_sample = this._inputData.bits === 8 ? 1 : 2;\n  const total_size = output_header_size\n                   + output_buffer_length_samples * 2 * this._inputData.channels * bytes_per_sample;\n\n  this._output_data = new ArrayBuffer(total_size);\n\n  this.output_dataview = new DataView(this._output_data);\n\n  this.output_dataview.setInt32(0, 2, true); // Version\n  this.output_dataview.setUint32(4, this._inputData.bits === 8, true); // Is 8 bit?\n  this.output_dataview.setInt32(8, this._inputData.sample_rate, true);\n  this.output_dataview.setInt32(12, this._output_samples_per_pixel, true);\n  this.output_dataview.setInt32(16, output_buffer_length_samples, true);\n  this.output_dataview.setInt32(20, this._inputData.channels, true);\n\n  this._outputWaveformData = new WaveformData(this._output_data);\n\n  this._input_index = 0;\n  this._output_index = 0;\n\n  const channels = this._inputData.channels;\n\n  this._min = new Array(channels);\n  this._max = new Array(channels);\n\n  for (let channel = 0; channel < channels; ++channel) {\n    if (this._input_buffer_size > 0) {\n      this._min[channel] = this._inputData.channel(channel).min_sample(this._input_index);\n      this._max[channel] = this._inputData.channel(channel).max_sample(this._input_index);\n    }\n    else {\n      this._min[channel] = 0;\n      this._max[channel] = 0;\n    }\n  }\n\n  this._min_value = this._inputData.bits === 8 ? -128 : -32768;\n  this._max_value = this._inputData.bits === 8 ?  127 :  32767;\n\n  this._where = 0;\n  this._prev_where = 0;\n  this._stop = 0;\n  this._last_input_index = 0;\n}\n\nWaveformResampler.prototype.sample_at_pixel = function(x) {\n  return Math.floor(x * this._output_samples_per_pixel);\n};\n\nWaveformResampler.prototype.next = function() {\n  let count = 0;\n  const total = 1000;\n  const channels = this._inputData.channels;\n  let channel;\n\n  while (this._input_index < this._input_buffer_size && count < total) {\n    while (Math.floor(this.sample_at_pixel(this._output_index) / this._scale) ===\n           this._input_index) {\n      if (this._output_index > 0) {\n        for (let i = 0; i < channels; ++i) {\n          channel = this._outputWaveformData.channel(i);\n\n          channel.set_min_sample(this._output_index - 1, this._min[i]);\n          channel.set_max_sample(this._output_index - 1, this._max[i]);\n        }\n      }\n\n      this._last_input_index = this._input_index;\n\n      this._output_index++;\n\n      this._where      = this.sample_at_pixel(this._output_index);\n      this._prev_where = this.sample_at_pixel(this._output_index - 1);\n\n      if (this._where !== this._prev_where) {\n        for (let i = 0; i < channels; ++i) {\n          this._min[i] = this._max_value;\n          this._max[i] = this._min_value;\n        }\n      }\n    }\n\n    this._where = this.sample_at_pixel(this._output_index);\n    this._stop = Math.floor(this._where / this._scale);\n\n    if (this._stop > this._input_buffer_size) {\n      this._stop = this._input_buffer_size;\n    }\n\n    while (this._input_index < this._stop) {\n      for (let i = 0; i < channels; ++i) {\n        channel = this._inputData.channel(i);\n\n        let value = channel.min_sample(this._input_index);\n\n        if (value < this._min[i]) {\n          this._min[i] = value;\n        }\n\n        value = channel.max_sample(this._input_index);\n\n        if (value > this._max[i]) {\n          this._max[i] = value;\n        }\n      }\n\n      this._input_index++;\n    }\n\n    count++;\n  }\n\n  if (this._input_index < this._input_buffer_size) {\n    // More to do\n    return false;\n  }\n  else {\n    // Done\n    if (this._input_index !== this._last_input_index) {\n      for (let i = 0; i < channels; ++i) {\n        channel = this._outputWaveformData.channel(i);\n\n        channel.set_min_sample(this._output_index - 1, this._min[i]);\n        channel.set_max_sample(this._output_index - 1, this._max[i]);\n      }\n    }\n\n    return true;\n  }\n};\n\nWaveformResampler.prototype.getOutputData = function() {\n  return this._output_data;\n};\n\nWaveformData.prototype = {\n\n  _getResampleOptions(options) {\n    const opts = {};\n\n    opts.scale = options.scale;\n    opts.width = options.width;\n\n    if (!isNullOrUndefined(opts.width) && (typeof opts.width !== 'number' || opts.width <= 0)) {\n      throw new RangeError('WaveformData.resample(): width should be a positive integer value');\n    }\n\n    if (!isNullOrUndefined(opts.scale) && (typeof opts.scale !== 'number' || opts.scale <= 0)) {\n      throw new RangeError('WaveformData.resample(): scale should be a positive integer value');\n    }\n\n    if (!opts.scale && !opts.width) {\n      throw new Error('WaveformData.resample(): Missing scale or width option');\n    }\n\n    if (opts.width) {\n      // Calculate the target scale for the resampled waveform\n      opts.scale = Math.floor(this.duration * this.sample_rate / opts.width);\n    }\n\n    if (opts.scale < this.scale) {\n      throw new Error(\n        'WaveformData.resample(): Zoom level ' + opts.scale +\n        ' too low, minimum: ' + this.scale\n      );\n    }\n\n    opts.abortSignal = options.abortSignal;\n\n    return opts;\n  },\n\n  resample: function(options) {\n    options = this._getResampleOptions(options);\n    options.waveformData = this;\n\n    const resampler = new WaveformResampler(options);\n\n    while (!resampler.next()) {\n      // nothing\n    }\n\n    return new WaveformData(resampler.getOutputData());\n  },\n\n  /**\n   * Concatenates with one or more other waveforms, returning a new WaveformData object.\n   */\n\n  concat: function() {\n    const self = this;\n    const otherWaveforms = Array.prototype.slice.call(arguments);\n\n    // Check that all the supplied waveforms are compatible\n    otherWaveforms.forEach(function(otherWaveform) {\n      if (self.channels !== otherWaveform.channels ||\n        self.sample_rate !== otherWaveform.sample_rate ||\n        self.bits !== otherWaveform.bits ||\n        self.scale !== otherWaveform.scale) {\n        throw new Error('WaveformData.concat(): Waveforms are incompatible');\n      }\n    });\n\n    const combinedBuffer = this._concatBuffers.apply(this, otherWaveforms);\n\n    return WaveformData.create(combinedBuffer);\n  },\n\n  /**\n   * Returns a new ArrayBuffer with the concatenated waveform.\n   * All waveforms must have identical metadata (version, channels, etc)\n   */\n\n  _concatBuffers: function() {\n    const otherWaveforms = Array.prototype.slice.call(arguments);\n    const headerSize = this._offset;\n    let totalSize = headerSize;\n    let totalDataLength = 0;\n    const bufferCollection = [this].concat(otherWaveforms).map(function(w) {\n      return w._data.buffer;\n    });\n\n    for (let i = 0; i < bufferCollection.length; i++) {\n      const buffer = bufferCollection[i];\n      const dataSize = new DataView(buffer).getInt32(16, true);\n\n      totalSize += buffer.byteLength - headerSize;\n      totalDataLength += dataSize;\n    }\n\n    const totalBuffer = new ArrayBuffer(totalSize);\n    const sourceHeader = new DataView(bufferCollection[0]);\n    const totalBufferView = new DataView(totalBuffer);\n\n    // Copy the header from the first chunk\n    for (let i = 0; i < headerSize; i++) {\n      totalBufferView.setUint8(i, sourceHeader.getUint8(i));\n    }\n\n    // Rewrite the data-length header item to reflect all of the samples concatenated together\n    totalBufferView.setInt32(16, totalDataLength, true);\n\n    let offset = 0;\n    const dataOfTotalBuffer = new Uint8Array(totalBuffer, headerSize);\n\n    for (let i = 0; i < bufferCollection.length; i++) {\n      const buffer = bufferCollection[i];\n\n      dataOfTotalBuffer.set(new Uint8Array(buffer, headerSize), offset);\n      offset += buffer.byteLength - headerSize;\n    }\n\n    return totalBuffer;\n  },\n\n  slice: function(options) {\n    let startIndex = 0;\n    let endIndex = 0;\n\n    if (!isNullOrUndefined(options.startIndex) && !isNullOrUndefined(options.endIndex)) {\n      startIndex = options.startIndex;\n      endIndex = options.endIndex;\n    }\n    else if (!isNullOrUndefined(options.startTime) && !isNullOrUndefined(options.endTime)) {\n      startIndex = this.at_time(options.startTime);\n      endIndex = this.at_time(options.endTime);\n    }\n\n    if (startIndex < 0) {\n      throw new RangeError('startIndex or startTime must not be negative');\n    }\n\n    if (endIndex < 0) {\n      throw new RangeError('endIndex or endTime must not be negative');\n    }\n\n    if (startIndex > this.length) {\n      startIndex = this.length;\n    }\n\n    if (endIndex > this.length) {\n      endIndex = this.length;\n    }\n\n    if (startIndex > endIndex) {\n      startIndex = endIndex;\n    }\n\n    const length = endIndex - startIndex;\n\n    const header_size = 24; // Version 2\n    const bytes_per_sample = this.bits === 8 ? 1 : 2;\n    const total_size = header_size\n                     + length * 2 * this.channels * bytes_per_sample;\n\n    const output_data = new ArrayBuffer(total_size);\n    const output_dataview = new DataView(output_data);\n\n    output_dataview.setInt32(0, 2, true); // Version\n    output_dataview.setUint32(4, this.bits === 8, true); // Is 8 bit?\n    output_dataview.setInt32(8, this.sample_rate, true);\n    output_dataview.setInt32(12, this.scale, true);\n    output_dataview.setInt32(16, length, true);\n    output_dataview.setInt32(20, this.channels, true);\n\n    for (let i = 0; i < length * this.channels * 2; i++) {\n      const sample = this._at(startIndex * this.channels * 2 + i);\n\n      if (this.bits === 8) {\n        output_dataview.setInt8(header_size + i, sample);\n      }\n      else {\n        output_dataview.setInt16(header_size + i * 2, sample, true);\n      }\n    }\n\n    return new WaveformData(output_data);\n  },\n\n  /**\n   * Returns the data format version number.\n   */\n\n  _version: function() {\n    return this._data.getInt32(0, true);\n  },\n\n  /**\n   * Returns the length of the waveform, in pixels.\n   */\n\n  get length() {\n    return this._data.getUint32(16, true);\n  },\n\n  /**\n   * Returns the number of bits per sample, either 8 or 16.\n   */\n\n  get bits() {\n    const bits = Boolean(this._data.getUint32(4, true));\n\n    return bits ? 8 : 16;\n  },\n\n  /**\n   * Returns the (approximate) duration of the audio file, in seconds.\n   */\n\n  get duration() {\n    return this.length * this.scale / this.sample_rate;\n  },\n\n  /**\n   * Returns the number of pixels per second.\n   */\n\n  get pixels_per_second() {\n    return this.sample_rate / this.scale;\n  },\n\n  /**\n   * Returns the amount of time represented by a single pixel, in seconds.\n   */\n\n  get seconds_per_pixel() {\n    return this.scale / this.sample_rate;\n  },\n\n  /**\n   * Returns the number of waveform channels.\n   */\n\n  get channels() {\n    if (this._version() === 2) {\n      return this._data.getInt32(20, true);\n    }\n    else {\n      return 1;\n    }\n  },\n\n  /**\n   * Returns a waveform channel.\n   */\n\n  channel: function(index) {\n    if (index >= 0 && index < this._channels.length) {\n      return this._channels[index];\n    }\n    else {\n      throw new RangeError('Invalid channel: ' + index);\n    }\n  },\n\n  /**\n   * Returns the number of audio samples per second.\n   */\n\n  get sample_rate() {\n    return this._data.getInt32(8, true);\n  },\n\n  /**\n   * Returns the number of audio samples per pixel.\n   */\n\n  get scale() {\n    return this._data.getInt32(12, true);\n  },\n\n  /**\n   * Returns a waveform data value at a specific offset.\n   */\n\n  _at: function at_sample(index) {\n    if (this.bits === 8) {\n      return this._data.getInt8(this._offset + index);\n    }\n    else {\n      return this._data.getInt16(this._offset + index * 2, true);\n    }\n  },\n\n  /**\n   * Sets a waveform data value at a specific offset.\n   */\n\n  _set_at: function set_at(index, sample) {\n    if (this.bits === 8) {\n      return this._data.setInt8(this._offset + index, sample);\n    }\n    else {\n      return this._data.setInt16(this._offset + index * 2, sample, true);\n    }\n  },\n\n  /**\n   * Returns the waveform data index position for a given time.\n   */\n\n  at_time: function at_time(time) {\n    return Math.floor(time * this.sample_rate / this.scale);\n  },\n\n  /**\n   * Returns the time in seconds for a given index.\n   */\n\n  time: function time(index) {\n    return index * this.scale / this.sample_rate;\n  },\n\n  /**\n   * Returns an object containing the waveform data.\n   */\n\n  toJSON: function() {\n    const waveform = {\n      version: 2,\n      channels: this.channels,\n      sample_rate: this.sample_rate,\n      samples_per_pixel: this.scale,\n      bits: this.bits,\n      length: this.length,\n      data: []\n    };\n\n    for (let i = 0; i < this.length; i++) {\n      for (let channel = 0; channel < this.channels; channel++) {\n        waveform.data.push(this.channel(channel).min_sample(i));\n        waveform.data.push(this.channel(channel).max_sample(i));\n      }\n    }\n\n    return waveform;\n  },\n\n  /**\n   * Returns the waveform data in binary format as an ArrayBuffer.\n   */\n\n  toArrayBuffer: function() {\n    return this._data.buffer;\n  }\n};\n\nexport default WaveformData;\n"],"names":["WaveformDataChannel","waveformData","channelIndex","_waveformData","_channelIndex","prototype","min_sample","index","offset","channels","_at","max_sample","set_min_sample","sample","_set_at","set_max_sample","min_array","length","values","i","push","max_array","INT8_MAX","INT8_MIN","INT16_MAX","INT16_MIN","calculateWaveformDataLength","audio_sample_count","scale","data_length","Math","floor","samples_remaining","generateWaveformData","options","amplitude_scale","split_channels","sample_rate","map","channel","Float32Array","output_channels","header_size","bytes_per_sample","bits","total_size","buffer","ArrayBuffer","data_view","DataView","scale_counter","min_value","Array","max_value","Infinity","range_min","range_max","setInt32","setUint32","setInt8","setInt16","isJsonWaveformData","data","_typeof","isBinaryWaveformData","isCompatible","view","version","getInt32","TypeError","convertJsonToBinary","expected_length","Error","array_buffer","data_object","samples_per_pixel","isNullOrUndefined","value","undefined","WaveformData","_data","_offset","_version","_channels","defaultOptions","disable_worker","getOptions","opts","getChannelData","audio_buffer","numberOfChannels","createFromAudioBuffer","callback","sampleRate","worker","WaveformDataWorker","onmessage","evt","postMessage","createFromArrayBuffer","audioContext","audioData","errorCallback","error","DOMException","promise","decodeAudioData","catch","create","createFromAudio","audio_context","WaveformResampler","_inputData","_output_samples_per_pixel","_scale","_input_buffer_size","input_buffer_length_samples","output_buffer_length_samples","ceil","output_header_size","_output_data","output_dataview","_outputWaveformData","_input_index","_output_index","_min","_max","_min_value","_max_value","_where","_prev_where","_stop","_last_input_index","sample_at_pixel","x","next","count","total","getOutputData","_getResampleOptions","width","RangeError","duration","abortSignal","resample","resampler","concat","self","otherWaveforms","slice","call","arguments","forEach","otherWaveform","combinedBuffer","_concatBuffers","apply","headerSize","totalSize","totalDataLength","bufferCollection","w","dataSize","byteLength","totalBuffer","sourceHeader","totalBufferView","setUint8","getUint8","dataOfTotalBuffer","Uint8Array","set","startIndex","endIndex","startTime","endTime","at_time","output_data","getUint32","Boolean","pixels_per_second","seconds_per_pixel","at_sample","getInt8","getInt16","set_at","time","toJSON","waveform","toArrayBuffer"],"mappings":"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"}